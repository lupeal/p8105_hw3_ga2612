---
title: "p8105_hw3_ga2612"
author: "Lupe Antonio"
date: "10/26/2023"
output: 
  github_document:
    toc: TRUE
---

```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(p8105.datasets)
library(forcats)
```

# Problem 1

```{r}
#loading dataset
data("instacart")

instacart <- instacart %>% as_tibble()
```

The instacart dataset has `r nrow(instacart)` observations and `r ncol(instacart)` variables/columns. Each row in this dataset represents a single product ordered through instacart. Variables of this dataset include order, product, and user IDs. Additionally, there are variables corresponding to the order in which product was added to cart, the time of order, days since prior order. There are also variables that describe the product, including product name (i.e. Yogurt, Milk, Water), the aisle (i.e. yogurt, fresh vegetables) and department (i.e. dairy eggs, produce) where it is located and the corresponding aisle and department IDs. 


```{r}
instacart %>%
  count(aisle) %>%
  arrange(desc(n))
```

There are a total of `r instacart %>% pull(aisle) %>% unique() %>% sum()` with fresh vegetables and fresh fruits are the ones ordered most from. Above is a chart summarizing all aisles with the number of products ordered per aisle. 


Below is a plot that shows the number of items ordered per aisle, for aisles with more than 10000 items ordered. The aisles are displayed in an ascending order, by number of items ordered per aisle. 

```{r}
instacart %>%
  count(aisle) %>%
  filter(n > 10000) %>%
  mutate(aisle = fct_reorder(aisle, n)) %>%
  ggplot(aes(x = aisle, y = n)) +
  geom_point() +
  ggtitle('Number of items ordered per aisle') +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


The table below shows the three most popular items in aisles "baking ingredients", "dog food care", and "packaged vegetables fruits". We can also see the number of times each product was ordered.

```{r, message=FALSE}
instacart %>%  
  filter(aisle == "baking ingredients" | aisle == "dog food care" | aisle == "packaged vegetables fruits") %>%
  group_by(aisle) %>%
  count(product_name) %>%
  #min_rank gives rank to each tie (btwn each filtering condition)
  #& we're going based on the highest n in each
  mutate(rank = min_rank(desc(n))) %>%
  filter(rank < 4) %>%
  arrange(desc(n)) %>%
  knitr::kable()
```


Below is a table that displays the average hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week. Based on the table, we can see that Pink Lady Apples tend to be ordered earlier in the day compared to Coffee Ice Cream. Day 5 is the exception, where they were on average ordered in the same hour of that day. 

```{r, message=FALSE}
instacart %>%
  filter(product_name == "Pink Lady Apples" | product_name == "Coffee Ice Cream") %>%
  group_by(product_name, order_dow) %>%
  summarize(avg_hour_of_day = mean(order_hour_of_day)) %>%
  pivot_wider(names_from = order_dow,
              values_from = avg_hour_of_day) %>%
  knitr::kable(digits = 2)
```


# Problem 2

```{r}
#loading dataset
data("brfss_smart2010")

brfss_smart2010 <- brfss_smart2010 %>% as_tibble()
```

First, do some data cleaning:

format the data to use appropriate variable names;
focus on the “Overall Health” topic

include only responses from “Excellent” to “Poor”
organize responses as a factor taking levels ordered from “Poor” to “Excellent”


cleaning = we want counties that have ratings from Excellent to Poor
```{r}
#data cleaning
brfss_smart2010 <- janitor::clean_names(brfss_smart2010) %>%
  rename(location_abrv = locationabbr,
         location_desc = locationdesc) %>%
  filter(topic == "Overall Health") %>%

```


```{r}
brfss_smart2010 %>%
  filter(!(location_desc %in% c('Excellent', 'Very good', 'Good', 'Fair', 'Poor'))) %>%
  mutate(response = as.factor(response),
         response = fct_reorder(response, display_order,
                                         .desc = TRUE))
```
response = fct_relevel(response, c('Poor', 'Fair', 'Good', 'Very good', 'Excellent')

```{r}
brfss_smart2010 %>%
  group_by(location_desc) %>%
  filter(response == c('Excellent', 'Very good', 'Good', 'Fair', 'Poor')) %>%
  mutate(response = as.factor(response),
         response = fct_reorder(response, display_order, .desc = TRUE))
```



# Problem 3

```{r, message = FALSE}
#importing data
nhanes_demo <- read_csv('data_hw3/nhanes_covar.csv')

nhanes_accel <- read_csv('data_hw3/nhanes_accel.csv')
```

Load, tidy, merge, and otherwise organize the data sets. Your final dataset should include all originally observed variables; 

exclude participants less than 21 years of age, and those with missing demographic data; and encode data with reasonable variable classes (i.e. not numeric, and using factors with the ordering of tables and plots in mind).

```{r}
#cleaning data
#note: sex (1 = male, 2 = female), edu (1 = less than high school, 2 = high school equiv, 3 = more than high)
nhanes_demo <- nhanes_demo[-c(1, 2, 3, 4),] %>%
  rename(seqn = '...1',
         sex = '1 = male',
         age = '...3',
         bmi = '...4',
         education = '1 = Less than high school') %>%
  mutate(seqn = as.double(seqn))

nhanes_accel <- janitor::clean_names(nhanes_accel)
```

```{r}
#merging datasets
nhanes_tidy <- left_join(nhanes_demo, nhanes_accel,
                         by = 'seqn')

#cleaning merged data
nhanes_tidy <- nhanes_tidy %>%
  filter(!(age < 21),
         !(is.na(sex)),
         !(is.na(age)),
         !(is.na(bmi)),
         !(is.na(education))) %>%
  mutate(
    sex = as.factor(sex),
    age = as.double(age),
    bmi = as.double(bmi),
    education = as.factor(education))
```


```{r}
nhanes_tidy %>%
  head()

# sex must be fctr
# edu must be fctr
# age must be dbl?
# bmi must be dbl?
```





`







