---
title: "p8105_hw3_ga2612"
author: "Lupe Antonio"
date: "10/26/2023"
output: 
  github_document:
    toc: TRUE
---

```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(p8105.datasets)
library(forcats)
library(RColorBrewer)
```

# Problem 1

```{r}
#loading dataset
data("instacart")

instacart <- instacart %>% as_tibble()
```

The instacart dataset has `r nrow(instacart)` observations and `r ncol(instacart)` variables/columns. Each row in this dataset represents a single product ordered through instacart. Variables of this dataset include order, product, and user IDs. Additionally, there are variables corresponding to the order in which product was added to cart, the time of order, days since prior order. There are also variables that describe the product, including product name (i.e. Yogurt, Milk, Water), the aisle (i.e. yogurt, fresh vegetables) and department (i.e. dairy eggs, produce) where it is located and the corresponding aisle and department IDs. 


```{r}
instacart %>%
  count(aisle) %>%
  arrange(desc(n))
```

There are a total of `r instacart %>% pull(aisle) %>% unique() %>% sum()` with fresh vegetables and fresh fruits are the ones ordered most from. Above is a chart summarizing all aisles with the number of products ordered per aisle. 


Below is a plot that shows the number of items ordered per aisle, for aisles with more than 10000 items ordered. The aisles are displayed in an ascending order, by number of items ordered per aisle. 

```{r}
instacart %>%
  count(aisle) %>%
  filter(n > 10000) %>%
  mutate(aisle = fct_reorder(aisle, n)) %>%
  ggplot(aes(x = aisle, y = n)) +
  geom_point() +
  ggtitle('Number of items ordered per aisle') +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


The table below shows the three most popular items in aisles "baking ingredients", "dog food care", and "packaged vegetables fruits". We can also see the number of times each product was ordered.

```{r, message=FALSE}
instacart %>%  
  filter(aisle == "baking ingredients" | aisle == "dog food care" | aisle == "packaged vegetables fruits") %>%
  group_by(aisle) %>%
  count(product_name) %>%
  #min_rank gives rank to each tie (btwn each filtering condition)
  #& we're going based on the highest n in each
  mutate(rank = min_rank(desc(n))) %>%
  filter(rank < 4) %>%
  arrange(desc(n)) %>%
  knitr::kable()
```


Below is a table that displays the average hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week. Based on the table, we can see that Pink Lady Apples tend to be ordered earlier in the day compared to Coffee Ice Cream. Day 5 is the exception, where they were on average ordered in the same hour of that day. 

```{r, message=FALSE}
instacart %>%
  filter(product_name == "Pink Lady Apples" | product_name == "Coffee Ice Cream") %>%
  group_by(product_name, order_dow) %>%
  summarize(avg_hour_of_day = mean(order_hour_of_day)) %>%
  pivot_wider(names_from = order_dow,
              values_from = avg_hour_of_day) %>%
  knitr::kable(digits = 2)
```


# Problem 2

```{r}
#loading dataset
data("brfss_smart2010")

brfss_smart2010 <- brfss_smart2010 %>% as_tibble()
```

First, do some data cleaning:

format the data to use appropriate variable names;
focus on the “Overall Health” topic

include only responses from “Excellent” to “Poor”
organize responses as a factor taking levels ordered from “Poor” to “Excellent”


cleaning = we want counties that have ratings from Excellent to Poor
```{r}
#data cleaning
brfss_smart2010 <- janitor::clean_names(brfss_smart2010) %>%
  rename(location_abrv = locationabbr,
         location_desc = locationdesc) %>%
  filter(topic == "Overall Health") %>%

```


```{r}
brfss_smart2010 %>%
  filter(!(location_desc %in% c('Excellent', 'Very good', 'Good', 'Fair', 'Poor'))) %>%
  mutate(response = as.factor(response),
         response = fct_reorder(response, display_order,
                                         .desc = TRUE))
```
response = fct_relevel(response, c('Poor', 'Fair', 'Good', 'Very good', 'Excellent')

```{r}
brfss_smart2010 %>%
  group_by(location_desc) %>%
  filter(response == c('Excellent', 'Very good', 'Good', 'Fair', 'Poor')) %>%
  mutate(response = as.factor(response),
         response = fct_reorder(response, display_order, .desc = TRUE))
```



# Problem 3

```{r, message = FALSE}
#importing data
nhanes_demo <- read_csv('data_hw3/nhanes_covar.csv')

nhanes_accel <- read_csv('data_hw3/nhanes_accel.csv')
```

```{r}
#cleaning data
#note: sex (1 = male, 2 = female), edu (1 = less than high school, 2 = high school equiv, 3 = more than high)
nhanes_demo <- nhanes_demo[-c(1, 2, 3, 4),] %>%
  rename(seqn = '...1',
         sex = '1 = male',
         age = '...3',
         bmi = '...4',
         education = '1 = Less than high school') %>%
  mutate(seqn = as.double(seqn))

nhanes_accel <- janitor::clean_names(nhanes_accel)
```

```{r}
#merging datasets
nhanes_tidy <- left_join(nhanes_demo, nhanes_accel,
                         by = 'seqn')

#cleaning merged data
nhanes_tidy <- nhanes_tidy %>%
  filter(!(age < 21),
         !(is.na(sex)),
         !(is.na(age)),
         !(is.na(bmi)),
         !(is.na(education))) %>%
  mutate(
    sex = as.factor(sex),
    age = as.double(age),
    bmi = as.double(bmi),
    education = as.factor(education)) %>%
  mutate(
    education = case_when(
      education == '1' ~ 'less than high school',
      education == '2' ~ 'high school equivalent',
      education == '3' ~ 'more than high school'),
      
    sex = case_when(
      sex == '1' ~ 'male',
      sex == '2' ~ 'female'))
```

and create a visualization of the age distributions for men and women in each education category. Comment on these items.

Below is a table for the number of men and women in each education category. We can see that when participants had less than high school and more than high school education, there were more females than males in both types of education. 

```{r}
#table for sex & education count
nhanes_tidy %>%
  group_by(education, sex) %>%
  count(sex) %>%
  pivot_wider(names_from = education,
              values_from = n) %>%
  knitr::kable()
```


Below is a visualization of the age distributions for men and women in each education category. We can see that when participants had more than high school education, they tend to be younger than the participants with less than or a high school equivalent education. 

```{r}
nhanes_tidy %>%
  ggplot(aes(x = age, fill = sex)) +
  geom_density(alpha = 0.5) +
  facet_grid(~education) +
  viridis::scale_fill_viridis(discrete = TRUE)

#another option for color
# scale_fill_brewer(palette = 'PuRd') 
```

Traditional analyses of accelerometer data focus on the total activity over the day. Using your tidied dataset, aggregate across minutes to create a total activity variable for each participant. Plot these total activities (y-axis) against age (x-axis); your plot should compare men to women and have separate panels for each education level. Include a trend line or a smooth to illustrate differences. Comment on your plot.


```{r}
#first try doesn't work, only picks first number
nhanes_tidy %>%
  mutate(total_activity = sum(min1:min1440)) %>%
  select(seqn, sex, age, bmi, education, total_activity)
```


```{r}
#checking above, but isn't working. 
nhanes_tidy %>%
  filter(seqn == '62161' & sex == 'male' & age == '22' & bmi == '23.3' & education == 'high school equivalent') %>%
  summarize(total_activity = sum(min1:min1440)) %>%
  select(seqn, sex, age, bmi, education, total_activity)
```



Below are plots for total activities across age for men and women in different education levels. From the plots we can see that for those with high school equivalent education total activity tended to decline for both male and females as age increased. For those with more than high school education, total activity tended to be higher for younger males than older males; for females there was higher total activity for middle-aged women. 

```{r,message=FALSE}
#finally? might work, but feeling iffy on total activity observations. 
nhanes_tidy %>%
  group_by(seqn, sex, age, bmi, education) %>%
  summarize(total_activity = sum(min1:min1440)) %>%
  ggplot(aes(x = age, y = total_activity, color = sex)) +
  geom_point(alpha = 1) +
  facet_grid(~education) +
  geom_smooth(se = FALSE) +
  scale_color_brewer(palette = 'Paired')
```


Accelerometer data allows the inspection activity over the course of the day. Make a three-panel plot that shows the 24-hour activity time courses for each education level and use color to indicate sex. Describe in words any patterns or conclusions you can make based on this graph; including smooth trends may help identify differences.


note: there are 1440 mins in 24 hrs and 1440 columns for minutes


```{r}
#xtra ideas
nhanes_tidy %>%
  group_by(seqn, sex, age, bmi, education) %>%
  pivot_longer(min1:min1440,
               names_to = 'minute',
               values_to = 'activity') %>%
  mutate(hour1 = case_when(
    min1:min60 ~ 
  ))
```

```{r}
nhanes_tidy %>%
  group_by(seqn, sex, age, bmi, education) %>%
  mutate(hour1 = sum(min1:min60),
         hour2 = sum(min60:min120),
         hour3 = sum(min120:min180),
         hour4 = sum(min180:min240),
         hour5 = sum(min240:min300),
         hour6 = sum(min300:min360),
         hour7 = sum(min360:min420),
         hour8 = sum(min420:min480),
         hour9 = sum(min480:min540),
         hour10 = sum(min540:min600),
         hour11 = sum(min600:min660),
         hour12 = sum(min660:min720),
         hour13 = sum(min720:min780),
         hour14 = sum(min780:min840),
         hour15 = sum(min840:min900),
         hour16 = sum(min900:min960),
         hour17 = sum(min960:min1020),
         hour18 = sum(min1020:min1080),
         hour19 = sum(min1080:min1140),
         hour20 = sum(min1140:min1200),
         hour21 = sum(min1200:min1260),
         hour22 = sum(min1260:min1320),
         hour23 = sum(min1320:min1380),
         hour24 = sum(min1380:min1440)) %>%
  select(seqn, sex, age, bmi, education, hour1:hour24) %>%
  pivot_longer(hour1:hour24,
               names_to = 'hour',
               values_to = 'activity') %>%
  ggplot(aes(x = fct_inorder(hour), y = activity, color = sex)) +
  geom_point() +
  facet_grid(~education) +
  geom_smooth(se = FALSE) +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1)) +
  scale_color_brewer(palette = 'Paired') +
  xlab('Hour')
```

The plot above shows the 24-hour activity time courses for each education level and sex. If we consider hour 1 to be 12am, for those with high school equivalent eduation we can see that there are higher activity levels around hours 7-9 which can be attributed to early morning exercises or commutes. This is also similar in the other two levels of education, but there is more activity in general/throughout the day for those with a more than high school education. 

